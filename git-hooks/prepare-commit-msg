#!/usr/bin/env bash
set -euo pipefail

MSG_FILE="$1"
SOURCE="${2:-}"
SHA="${3:-}"

# Forbidden AI attribution patterns (case-insensitive)
PATTERNS=(
  "co-authored-by:.*claude"
  "co-authored-by:.*anthropic"
  "co-authored-by:.*copilot"
  "co-authored-by:.*github"
  "co-authored-by:.*gpt"
  "co-authored-by:.*openai"
  "generated with.*claude"
  "generated by.*claude"
  "generated with.*copilot"
  "generated by.*copilot"
  "generated with.*gpt"
  "generated by.*gpt"
  "claude code"
  "anthropic"
  "github copilot"
  "chatgpt"
  "openai"
)

for pat in "${PATTERNS[@]}"; do
  if grep -Eiq "$pat" "$MSG_FILE"; then
    echo "ERROR: Commit message contains forbidden AI attribution."
    echo "Pattern matched: $pat"
    echo
    echo "This repository forbids AI authorship markers."
    echo "Edit the commit message or disable the agent feature."
    exit 1
  fi
done

exit 0
